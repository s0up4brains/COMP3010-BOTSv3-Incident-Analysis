# COMP3010-BOTSv3-Incident-Analysis

Investigation and report on security incidents using the Boss of the SOC v3 (BOTSv3) dataset within Splunk





##### Introduction



A Security Operations Centre (SOC) monitors, detects, analyses and responds to cybersecurity threats. The SOC defends their respective organisations from malicious activity, protecting critical systems, data and infrastructures allowing for early threat detection, resulting in effective response to incidents. SOC's use Security Information and Event Management (SIEM) tools - such as Splunk to present and sort large volumes of log data from multiple sources able to be viewed in real time. This allows SOC analysts to detect irregular behaviour, investigate incidents and make informed decisions on how to respond to incidents.



The BOTSv3 exercise is a sample security dataset to enhance CTF cybersecurity skills. The exercise simulates a realistic SOC investigation incident involving a fictitious brewing company, 'frothly'. The incident can be uncovered through a series of data logs including those generated by network, endpoint, email, and AWS cloud service. BOTSv3 requires analysts to reconstruct the attack timeline using standard incident response procedures.



The objectives of this investigation are primarily to answer the AWS and endpoint focused 200-level questions, uncover the events of the incident and produce a full incident report that details a strategy for mitigating risk in the future. Using Splunk, the BOTSv3 logs can be investigated to uncover the events of the incident. The scope of the investigation has been limited to answering only the AWS and endpoint related 200-level questions. No investigation into specific malware or malware structures (i.e. malware reverse engineering) will take place in the investigation. This approach mirrors the approach taken by an SOC analyst, operating on a constrained scope to prioritise relevant data sources and advance response times.



The following assumptions have been made regarding the components of the investigation:

* The logs are accurate, complete and trustworthy
* Timestamps are properly formatted and accurate
* The dataset contains evidence of malicious activity



##### SOC Roles



A Security Operations Centre is typically structured into a tiered team for greater and expertise at each level and continuous monitoring, detection, analysis and response to incidents. There are three tiers to an SOC:



* Tier 1 (Triage/Monitoring): Responsible for initial alert monitoring and confirming suspicious activity as an incident for further investigation.
* Tier 2 (Incident Analysis): Provide an in-depth investigation into alerts, data logs and attack techniques of events flagged by tier 1.
* Tier 3 (Threat Hunting \& Response): Execute an advanced analysis into the data, hunting for threats and providing strategies for mitigating impact and supporting preventative solutions for the future.



In BOTSv3, the investigation primarily reflects Tier 1 and Tier 2 SOC activities, however in this incident report highlights appropriate incident response and improvements to detection.



##### SOC Incident Handling Methodology



Security Operations Centres have plans in place for handling incidents, analysts from each tier are trained for they are expected to operate per the company plan. Precise methods for incident handling may vary between SOC's. However, SOC's generally follow the same key points of preventative measures, detecting threats, responding to threats and recovering from the resulting damage. The key tasks of incident handling methodology include:



* prevention
* detection
* response
* recovery



The CREST Cyber Security Incident Response Guide details a structured framework for response and recovery; the guide mirrors the approach used in SOC investigations such as the BOTSv3 exercise. While BOTSv3 reflects a structured SOC incident - in line with the cyber kill chain - SOC's can face additional challenges. Further challenges involve real-world issues such as pursuing legal action and coordination with cloud and network engineers. These issues are outside the scope of the fictious BOTSv3 dataset.



##### Installation \& Data Preparation



Since the dataset potentially contains malware; it was important to investigate the BOTSv3 dataset in a virtual environment. Splunk Enterprise was installed on an Ubuntu 24.04 virtual machine, replicating a typical SOC analysis environment. Provided with the BOTSv3 dataset were deployment instructions which were followed. Then, the dataset was validated by checking the 'index=botsv3 earliest=0' index search query. This returned a series of event logs relating to the BOTSv3 dataset, ready for investigation with Splunk's Search Processing Language (SPL).

The AWS CloudTrail documentation was a useful tool in understanding the logs and filtering through logs.



tools used



Justify Decisions in context of SOC infrastructure

Evidence



At the midpoint of the investigation, I travelled away from the Computer with the Linux and Splunk installation. Operating from my laptop during the winter holidays meant setting up a new Ubuntu Virtual Machine, installing Splunk again and re-ingesting the BOTSv3 dataset.



##### AWS endpoint events



The following section answers the provided 200-level questions relating to AWS and endpoint. Each subsection provides an explanation of the investigation, the query or chain of queries which uncovered the answer, the timestamp of the relevant log, a screenshot as evidence, any dashboards used to compile data results, the relevant answer and - if applicable- any threat intel lookup.



TEMPLATE

-Detailed Explanation with SOC Relevance

-Question

-Query

-Timestamp

-Screenshot

-Dashboards

-Answer

-Threat Intel Lookup





Question 1. IAM users that accessed an AWS service

Query: index=botsv3 sourcetype="aws:cloudtrail" userIdentity.type=IAMUser | stats values(userIdentity.userName) as users

This query analyses AWS cloudtrail logs to identify IAM users who accessed AWS services. CloudTrail logs record all AWS API activity. Filtering for IAM users helps to identify unauthorised access, compromised credentials and misuse of accounts with enabled privileges. The query returns a list of all IAM user values

!\[Question 1 Query Evidence](/evidence/Q1/betterQueryString.png)

Answer: bstoll,btun,splunk\_access,web\_admin

!\[Question 1 Answer Evidence](/evidence/Q1/Usernme.png)





Question 2. What field would you use to alert that AWS API activity has occurred without MFA (multi-factor authentication)?



Question 3. What is the processor number used on the web servers?



Question 4. Bud accidentally makes an S3 bucket publicly accessible. What is the event ID of the API call that enabled public access? Answer guidance: Include any special characters/punctuation.



Question 5. What is Bud's username?



Question 6. What is the name of the S3 bucket that was made publicly accessible?



Question 7. What is the name of the text file that was successfully uploaded into the S3 bucket while it was publicly accessible?



Question 8. What is the FQDN of the endpoint that is running a different Windows operating system edition than the others?





###### (IOC) Indicators of Compromise

###### 

###### Detection Methodology



###### Chronology of Events



TIMESTAMP HERE user 'bstoll' (Bud) logged in without Multi Factor Authenication



TIMESTAMP HERE S3 Bucket 'frothlywebcode' was made publicly accessible using (COMMAND HERE)



TIMESTAMP HERE Text file 'OPEN\_BUCKET\_PLEAE\_FIX.txt' was uploaded to the open bucket



TIMESTAMP HERE S3 Bucket 'frothlywebcode' was made private again



8/20/18 2:04:02:640 PM 'aws:cloudwatch:guardduty' caught extrernal known malicious IP probing an Open Port (SSH port 22 on an EC2 Instance i-0cc93bade2b3cba63 was reachable). Origninating from IP: 122.122.243.11 , Location: Beijing, China , ISP: China Telecom , Threat list: Proofpoint





##### Conclusion



Findings

Key Lessons

SOC strategy implications

Improvements to be made to detection and response

MFA, alerting, s3 control improvements, give employees access to only necessary features



References (IEEE style)



SPLUNK (SIEM USED)

https://www.splunk.com/en\_us/download/splunk-enterprise.html?utm\_campaign=google\_emea\_tier1\_en\_search\_brand\&utm\_source=google\&utm\_medium=cpc\&utm\_content=Splunk\_Enterprise\_Demo\_v2\&utm\_term=splunk\&device=c\&\_bt=721259171719\&\_bm=e\&\_bn=g\&gad\_source=1\&gad\_campaignid=765600233\&gbraid=0AAAAAD8kDz1X9ahqgz6BumqBsPCb0ce83\&gclid=Cj0KCQiApL7KBhC7ARIsAD2Xq3CJZZIX32Ww9mVqqIU427vlx5Rc49U7OHMh2E52hSQw3ffTY0t8UAAaAv8xEALw\_wcB





UBUNTU LINUX 24.04.3 (VM ISO USED)

https://ubuntu.com/download/desktop





BOTSv3



SOC

https://www.ibm.com/think/topics/security-operations-center



AWS Cloudtraildocumentation



AWS GuardDuty



NIST incident response lifecycle



Crest cybersecurity incident response guide

